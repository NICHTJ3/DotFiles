#!/usr/bin/env bash

set -e

MYNAME=${0##*/}  # Short program name for diagnostic messages.
CONFIG="install.conf.yaml"
DOTBOT_DIR="dotbot"

DOTBOT_BIN="bin/dotbot"
BASEDIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

cd "${BASEDIR}"
git -C "${DOTBOT_DIR}" submodule sync --quiet --recursive
git submodule update --init --recursive "${DOTBOT_DIR}"

function shared() {
  "${BASEDIR}/${DOTBOT_DIR}/${DOTBOT_BIN}" -d "${BASEDIR}/shared" -c "${BASEDIR}/shared/${CONFIG}" "${@}"
}

function linux() {
  "${BASEDIR}/${DOTBOT_DIR}/${DOTBOT_BIN}" -d "${BASEDIR}/linux" -c "${BASEDIR}/linux/${CONFIG}" "${@}"
}

function misc() {
  "${BASEDIR}/${DOTBOT_DIR}/${DOTBOT_BIN}" -d "${BASEDIR}/misc" -c "${BASEDIR}/misc/${CONFIG}" "${@}"
}


help () {
  cat << EOF

usage: $MYNAME [Option] [dotbot args (optional)]

Options:
  - shared - Install dotfiles relating to my wsl/linux terminal development
  - linux - Install dotfiles relating to my dwm install
  - misc - Install dotfiles relating to random applications
  - help - Show this message and exit

EOF
  exit $1
}

option=$1
shift 1

if [[ $option ]]; then
  echo You are using option: "$option"
  case $option in
   help) help ;;
   linux) linux $@ ;;
   misc) misc $@ ;;
   shared) shared $@ ;;
  esac
else
  help
fi

unset help
unset linux
unset misc
unset shared
